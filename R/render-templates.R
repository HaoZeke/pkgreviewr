#' Create review templates.
#'
#' Creates skeleton review files:
#' \itemize{
#' \item `index.Rmd`: `html_notebook` to perform and record review in
#' \item `pkgreview.md`: review response submission template.
#' \item `README.md`: prepopulated README for review repo.
#' }
#' `index.Rmd` will be automatically added to `.Rbuildignore`. The resulting templates are populated with default
#' YAML frontmatter and R fenced code chunks (`Rmd`).
#'
#' @param pkg_data package metadata generated by pkgreview_getdata()
#' @param open allow interaction
#'
#' @export
# @importFrom usethis getFromNamespace check_installed
# @importFrom usethis getFromNamespace render_template
#' @examples
#' \dontrun{
#' pkg_data <- pkgreview_getdata(pkg_dir)
#' pkgreview_index_rmd(pkg_data)
#' pkgreview_readme_md(pkg_data)
#' pkgreview_pkgreview_md(pkg_data)
#' }
pkgreview_index_rmd <- function(pkg_data, open = F) {
    usethis:::check_installed("rmarkdown")

    usethis::use_template(
        "review-index",
        "index.Rmd",
        data = pkg_data,
        ignore = TRUE,
        open = open,
        package = "pkgreviewr"
    )

    if (usethis:::uses_git()) {
        usethis::use_git_hook(
            "pre-commit",
            usethis:::render_template("readme-rmd-pre-commit.sh",
                                      package = "pkgreviewr")
        )
    }

    invisible(TRUE)
}

#' @export
#' @rdname pkgreview_index_rmd
pkgreview_readme_md <- function(pkg_data, open = F) {

    usethis::use_template(
        "review-README",
        "README.md",
        data = pkg_data,
        ignore = TRUE,
        open = open,
        package = "pkgreviewr"
    )
}

#' @export
#' @rdname pkgreview_index_rmd
pkgreview_pkgreview_md <- function(pkg_data, open = F) {

    usethis::use_template(
        "pkgreview.md",
        "pkgreview.md",
        data = pkg_data,
        ignore = TRUE,
        open = open,
        package = "pkgreviewr"
    )
}


# get review text from ropensci onboarding repo
use_reviewtmpl <- function(open = F){
    review_url <- "https://raw.githubusercontent.com/ropensci/onboarding/master/reviewer_template.md"
    review_txt <- RCurl::getURL(review_url, ssl.verifypeer = FALSE)

    new <- usethis:::write_over(usethis::proj_get(), "pkgreview.md", review_txt)
    if(open){
        usethis:::edit_file(usethis::proj_get(), "pkgreview.md")
    }
    invisible(new)
}
